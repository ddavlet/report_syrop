## Отказавшиеся вкусы

Коротко: отчёт ищет позиции (товары), которые перестали покупать вовсе или стали покупать намного реже, сравнивая недавний период с базовым. В Excel — две вкладки: «ByClient» (по клиентам) и «Overall» (общий срез по позициям).

### Параметры
- **recent_days**: длина недавнего периода в днях. По умолчанию — `14` (в боте).
  - Рекомендуемый диапазон: 14–60. Короткий период (14–30) быстрее реагирует, но шумнее.
  - Пример: при `recent_days=30` сравниваем последние 30 дней с базой перед ними.
- **baseline_days**: длина базового периода в днях до недавнего. По умолчанию — `60`.
  - База должна быть не меньше недавнего периода, чаще — в 2–3 раза больше, чтобы стабилизировать оценку.
  - Пример: `recent_days=30`, `baseline_days=90` → база: 90 дней до последних 30.
- **min_item_orders_base**: минимальное число заказов позиции в базовом периоде, чтобы позиция считалась значимой. По умолчанию — `1`.
  - Повышайте до 3–5, чтобы отсечь случайные разовые покупки в базе.
  - Влияние: позиции с `orders_base < min_item_orders_base` полностью исключаются.
- **min_client_orders_recent**: минимальное число заказов клиента в недавнем периоде (для вкладки ByClient). По умолчанию — `1`.
  - Помогает не считать «отказом вкуса» клиентов, которые вообще не покупали ничего недавно.
  - Пример: при `min_client_orders_recent=2` клиент должен сделать хотя бы 2 любых заказа за недавний период, чтобы его падение по конкретной позиции учитывалось.
- **min_drop_pct**: порог падения частоты покупок (в процентах) для вкладки Overall, если позицию всё ещё покупают реже. По умолчанию — `30`.
  - Как считается: `change_pct = freq_recent_per_day / freq_base_per_day - 1`. Фильтр срабатывает, если `orders_recent == 0` ИЛИ `change_pct ≤ -min_drop_pct/100`.
  - Рекомендуемый диапазон: 30–70. Больше — строже, меньше — чувствительнее.

### Вкладка ByClient (по клиентам)
- **client**: клиент.
- **item**: позиция/товар.
- **orders_base**: число заказов этой позиции у клиента в базовом периоде.
- **revenue_base**: выручка по позиции у клиента в базовом периоде.
- **client_orders_base**: всего заказов клиента в базовом периоде (по всем позициям).
- **client_orders_recent**: всего заказов клиента в недавнем периоде (по всем позициям).
- **last_purchase**: дата последней покупки позиции у клиента.
- **days_since_last**: дней с последней покупки позиции у клиента.
- **period_base**: границы базового периода.
- **period_recent**: границы недавнего периода.

### Вкладка Overall (общий срез по позициям)
- **item**: позиция/товар.
- **orders_base**: число заказов позиции в базовом периоде.
- **orders_recent**: число заказов позиции в недавнем периоде.
- **freq_base_per_day**: среднее число заказов в день в базовом периоде.
- **freq_recent_per_day**: среднее число заказов в день в недавнем периоде.
- **change_pct**: изменение частоты (недавняя/базовая − 1), доля (например, −0.5 = −50%).
  - Пример интерпретации: `-0.3` = частота упала на 30%; `0` = без изменений; `-1` = покупок не было в недавнем периоде.
- **revenue_base**: выручка по позиции в базовом периоде.
- **last_purchase**: дата последней покупки позиции (по всем клиентам).
- **days_since_last**: дней с последней покупки позиции.
- **period_base**: границы базового периода.
- **period_recent**: границы недавнего периода.


